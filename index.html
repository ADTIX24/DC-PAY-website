<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم DC Pay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .sidebar-link.active {
            background-color: #38bdf8;
            color: #ffffff;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="relative min-h-screen md:flex">
        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu-overlay" class="md:hidden fixed inset-0 bg-black/50 z-30 hidden"></div>
        
        <!-- Mobile Menu Button (This is the header on mobile) -->
        <div class="md:hidden flex justify-between items-center bg-[#0d1a2e] p-4 fixed top-0 right-0 left-0 z-20">
            <div class="flex items-center space-x-2">
                <svg class="h-8 w-8 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                </svg>
                <span class="text-xl font-bold text-white">DC Pay</span>
            </div>
            <button id="mobile-menu-btn" class="text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>

        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 bg-[#0d1a2e] p-6 flex flex-col justify-between fixed inset-y-0 right-0 transform translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out z-40">
            <div>
                <div class="hidden md:flex items-center space-x-2 mb-10">
                    <svg class="h-8 w-8 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                    <span class="text-2xl font-bold text-white">DC Pay</span>
                </div>

                <nav class="space-y-4 pt-16 md:pt-0">
                    <a href="index.html" target="_blank" class="sidebar-link flex items-center gap-x-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-sky-500 hover:text-white transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        <span>عرض الموقع</span>
                    </a>
                    <a href="#" class="sidebar-link flex items-center gap-x-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-sky-500 hover:text-white transition active" data-page="dashboard">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a2 2 0 002 2h10a2 2 0 002-2V10M9 20h6"></path></svg>
                        <span>الرئيسية</span>
                    </a>
                    <a href="#" class="sidebar-link flex items-center gap-x-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-sky-500 hover:text-white transition" data-page="transactions">
                         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        <span>الحوالات</span>
                    </a>
                    <a href="#" class="sidebar-link flex items-center gap-x-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-sky-500 hover:text-white transition" data-page="users">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.975 5.975 0 0112 13a5.975 5.975 0 012.87-5.197M12 13a4 4 0 110-5.292 4 4 0 010 5.292z"></path></svg>
                        <span>المستخدمون</span>
                    </a>
                     <a href="#" class="sidebar-link flex items-center gap-x-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-sky-500 hover:text-white transition" data-page="exchange-rates">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 18v-2m0-10a6 6 0 00-6 6v1a6 6 0 006 6v0a6 6 0 006-6v-1a6 6 0 00-6-6z"></path></svg>
                        <span>أسعار الصرف</span>
                    </a>
                    <a href="#" class="sidebar-link flex items-center gap-x-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-sky-500 hover:text-white transition" data-page="general-settings">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <span>اعدادات عامة</span>
                    </a>
                </nav>
            </div>
            <div>
                 <a href="#" class="sidebar-link flex items-center gap-x-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-red-500/80 hover:text-white transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    <span>تسجيل الخروج</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8 overflow-y-auto pt-24 md:pt-8">
            
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <h1 class="text-3xl font-bold mb-8">لوحة التحكم الرئيسية</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-[#1a2c47] p-6 rounded-xl border border-[#2a3f6c]">
                        <h3 class="text-gray-400 text-lg">إجمالي المستخدمين</h3>
                        <p id="total-users" class="text-4xl font-bold mt-2">0</p>
                    </div>
                    <div class="bg-[#1a2c47] p-6 rounded-xl border border-[#2a3f6c]">
                        <h3 class="text-gray-400 text-lg">الحوالات المعلقة</h3>
                        <p id="pending-transactions" class="text-4xl font-bold mt-2 text-yellow-400">0</p>
                    </div>
                    <div class="bg-[#1a2c47] p-6 rounded-xl border border-[#2a3f6c]">
                        <h3 class="text-gray-400 text-lg">الحوالات المنجزة</h3>
                        <p id="completed-transactions" class="text-4xl font-bold mt-2 text-green-400">0</p>
                    </div>
                    <div class="bg-[#1a2c47] p-6 rounded-xl border border-[#2a3f6c]">
                        <h3 class="text-gray-400 text-lg">إجمالي الإيداعات</h3>
                        <p id="total-deposits" class="text-4xl font-bold mt-2">$0</p>
                    </div>
                </div>
            </section>

            <!-- Transactions Section -->
            <section id="transactions" class="section">
                <h1 class="text-3xl font-bold mb-8">إدارة الحوالات</h1>
                <div class="bg-[#1a2c47] rounded-xl border border-[#2a3f6c] overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-right min-w-[900px]">
                            <thead class="bg-[#0d1a2e]">
                                <tr>
                                    <th class="p-4">التاريخ</th>
                                    <th class="p-4">اسم المستخدم</th>
                                    <th class="p-4">رقم الهاتف</th>
                                    <th class="p-4">الإيميل</th>
                                    <th class="p-4">المبلغ</th>
                                    <th class="p-4">نوع الإيداع</th>
                                    <th class="p-4">نوع السحب</th>
                                    <th class="p-4">الحالة</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-table-body">
                                <!-- Data will be populated here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users" class="section">
                <h1 class="text-3xl font-bold mb-8">المستخدمون المسجلون</h1>
                 <div class="bg-[#1a2c47] rounded-xl border border-[#2a3f6c] overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-right min-w-[600px]">
                            <thead class="bg-[#0d1a2e]">
                                <tr>
                                    <th class="p-4">الاسم الكامل</th>
                                    <th class="p-4">البريد الإلكتروني</th>
                                    <th class="p-4">رقم الهاتف</th>
                                    <th class="p-4">تاريخ التسجيل</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                               <!-- Data will be populated here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Exchange Rates Section -->
            <section id="exchange-rates" class="section">
                <h1 class="text-3xl font-bold mb-8">إعدادات أسعار الصرف والعمولة</h1>
                <div class="max-w-2xl mx-auto bg-[#1a2c47] p-8 rounded-xl border border-[#2a3f6c]">
                    <form class="space-y-6">
                        <div>
                            <label for="syr-rate" class="block mb-2 text-lg font-medium text-gray-300">سعر الصرف للدولار مقابل الليرة (1$ = ? ل.س)</label>
                            <input type="number" step="any" id="syr-rate" class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                        </div>
                        <div>
                            <label for="jod-rate" class="block mb-2 text-lg font-medium text-gray-300">سعر الصرف للدولار مقابل الدينار (1$ = ? d.أ)</label>
                            <input type="number" step="any" id="jod-rate" class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                        </div>
                         <div>
                            <label for="sar-rate" class="block mb-2 text-lg font-medium text-gray-300">سعر الصرف للدولار مقابل الريال (1$ = ? ر.س)</label>
                            <input type="number" step="any" id="sar-rate" class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                        </div>
                        <div>
                            <label for="commission-rate" class="block mb-2 text-lg font-medium text-gray-300">عمولة التطبيق (%)</label>
                            <input type="number" step="any" id="commission-rate" class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                        </div>
                        <button type="button" id="save-settings-btn" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-lg transition">حفظ التغييرات</button>
                    </form>
                    <div id="settings-success-msg" class="hidden mt-4 text-center p-3 rounded-lg bg-green-500/20 text-green-300">
                        تم حفظ الإعدادات بنجاح!
                    </div>
                </div>
            </section>
            
            <!-- General Settings Section -->
            <section id="general-settings" class="section">
                 <h1 class="text-3xl font-bold mb-8">اعدادات عامة</h1>
                 <div class="max-w-2xl mx-auto bg-[#1a2c47] p-8 rounded-xl border border-[#2a3f6c]">
                    <form id="general-settings-form" class="space-y-8">
                        <div>
                            <h3 class="text-xl font-bold mb-4 border-b border-gray-700 pb-2">اللوغو</h3>
                            <label for="logo-upload" class="block mb-2 text-sm font-medium text-gray-300">تحميل شعار جديد (سيظهر في رأس وتذييل الصفحة)</label>
                            <input type="file" id="logo-upload" class="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-sky-500/10 file:text-sky-300 hover:file:bg-sky-500/20" accept="image/*">
                        </div>
                        <div>
                             <h3 class="text-xl font-bold mb-4 border-b border-gray-700 pb-2">روابط التواصل الاجتماعي</h3>
                             <div class="space-y-4">
                                 <div>
                                     <label for="whatsapp-link" class="block mb-2 text-sm font-medium text-gray-300">رابط الواتساب</label>
                                      <input type="url" id="whatsapp-link" placeholder="https://wa.me/..." class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                                 </div>
                                  <div>
                                     <label for="instagram-link" class="block mb-2 text-sm font-medium text-gray-300">رابط انستغرام</label>
                                      <input type="url" id="instagram-link" placeholder="https://instagram.com/..." class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                                 </div>
                                  <div>
                                     <label for="facebook-link" class="block mb-2 text-sm font-medium text-gray-300">رابط فيسبوك</label>
                                      <input type="url" id="facebook-link" placeholder="https://facebook.com/..." class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                                 </div>
                                  <div>
                                     <label for="telegram-link" class="block mb-2 text-sm font-medium text-gray-300">رابط تيليغرام</label>
                                      <input type="url" id="telegram-link" placeholder="https://t.me/..." class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                                 </div>
                                  <div>
                                     <label for="x-link" class="block mb-2 text-sm font-medium text-gray-300">رابط X (تويتر سابقاً)</label>
                                      <input type="url" id="x-link" placeholder="https://x.com/..." class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                                 </div>
                             </div>
                        </div>
                         <div>
                             <h3 class="text-xl font-bold mb-4 border-b border-gray-700 pb-2">ايميل الشركة</h3>
                             <div>
                                 <label for="company-email" class="block mb-2 text-sm font-medium text-gray-300">البريد الإلكتروني للتواصل</label>
                                  <input type="email" id="company-email" placeholder="contact@example.com" class="w-full bg-[#0d1a2e] border border-[#2a3f6c] rounded-lg p-3 text-white focus:outline-none focus:border-sky-500">
                             </div>
                        </div>
                        <button type="submit" id="save-general-settings-btn" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-lg transition">حفظ التغييرات العامة</button>
                    </form>
                     <div id="general-settings-success-msg" class="hidden mt-4 text-center p-3 rounded-lg bg-green-500/20 text-green-300">
                        تم حفظ الإعدادات العامة بنجاح!
                    </div>
                 </div>
            </section>

        </main>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);

        document.addEventListener('DOMContentLoaded', async function () {
            // Authenticate with Firebase
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase Authentication failed:", error);
                return; 
            }
            
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            const sections = document.querySelectorAll('.section');

            const toggleMenu = () => {
                sidebar.classList.toggle('translate-x-full');
                mobileMenuOverlay.classList.toggle('hidden');
            };
            
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', toggleMenu);
            }
            if(mobileMenuOverlay) {
                mobileMenuOverlay.addEventListener('click', toggleMenu);
            }

            function switchPage(pageId) {
                sections.forEach(section => section.classList.remove('active'));
                const activeSection = document.getElementById(pageId);
                if (activeSection) activeSection.classList.add('active');

                sidebarLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === pageId) link.classList.add('active');
                });
                if (window.innerWidth < 768) {
                    sidebar.classList.add('translate-x-full');
                    mobileMenuOverlay.classList.add('hidden');
                }
            }

            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    if (link.dataset.page) {
                        e.preventDefault();
                        switchPage(link.dataset.page);
                    }
                });
            });

            // Exchange Rates Settings Logic
            const exchangeRatesDocRef = doc(db, `/artifacts/${appId}/public/data/settings`, "exchangeRates");
            const syrRateInput = document.getElementById('syr-rate');
            const jodRateInput = document.getElementById('jod-rate');
            const sarRateInput = document.getElementById('sar-rate');
            const commissionRateInput = document.getElementById('commission-rate');
            const saveSettingsBtn = document.getElementById('save-settings-btn');
            const settingsSuccessMsg = document.getElementById('settings-success-msg');

            getDoc(exchangeRatesDocRef).then(docSnap => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    syrRateInput.value = data.syrRate || 11300;
                    jodRateInput.value = data.jodRate || 0.72;
                    sarRateInput.value = data.sarRate || 3.95;
                    commissionRateInput.value = data.commissionRate || 5;
                }
            }).catch(error => console.error("Error fetching exchange rates:", error));

            if(saveSettingsBtn) {
                saveSettingsBtn.addEventListener('click', async () => {
                    saveSettingsBtn.disabled = true;
                    saveSettingsBtn.textContent = 'جاري الحفظ...';
                    try {
                        await setDoc(exchangeRatesDocRef, {
                            syrRate: parseFloat(syrRateInput.value),
                            jodRate: parseFloat(jodRateInput.value),
                            sarRate: parseFloat(sarRateInput.value),
                            commissionRate: parseFloat(commissionRateInput.value)
                        });
                        settingsSuccessMsg.classList.remove('hidden');
                        setTimeout(() => settingsSuccessMsg.classList.add('hidden'), 3000);
                    } catch (error) {
                        console.error("Error saving settings:", error);
                        alert('حدث خطأ أثناء حفظ الإعدادات.');
                    } finally {
                        saveSettingsBtn.disabled = false;
                        saveSettingsBtn.textContent = 'حفظ التغييرات';
                    }
                });
            }
            
            // General Settings Logic
            const generalSettingsDocRef = doc(db, `/artifacts/${appId}/public/data/settings`, "general");
            const generalSettingsForm = document.getElementById('general-settings-form');
            const logoUploadInput = document.getElementById('logo-upload');
            const whatsappLinkInput = document.getElementById('whatsapp-link');
            const instagramLinkInput = document.getElementById('instagram-link');
            const facebookLinkInput = document.getElementById('facebook-link');
            const telegramLinkInput = document.getElementById('telegram-link');
            const xLinkInput = document.getElementById('x-link');
            const companyEmailInput = document.getElementById('company-email');
            const saveGeneralBtn = document.getElementById('save-general-settings-btn');
            const generalSuccessMsg = document.getElementById('general-settings-success-msg');

            getDoc(generalSettingsDocRef).then(docSnap => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    whatsappLinkInput.value = data.whatsapp || '';
                    instagramLinkInput.value = data.instagram || '';
                    facebookLinkInput.value = data.facebook || '';
                    telegramLinkInput.value = data.telegram || '';
                    xLinkInput.value = data.x || '';
                    companyEmailInput.value = data.email || '';
                }
            }).catch(error => console.error("Error fetching general settings:", error));

             if(generalSettingsForm) {
                generalSettingsForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    saveGeneralBtn.disabled = true;
                    saveGeneralBtn.textContent = 'جاري الحفظ...';
                    
                    try {
                        const file = logoUploadInput.files[0];
                        let logoUrl = null;
                        if (file) {
                             const storageRef = ref(storage, `logos/${appId}/logo`);
                             const snapshot = await uploadBytes(storageRef, file);
                             logoUrl = await getDownloadURL(snapshot.ref);
                        }

                        const settingsData = {
                           whatsapp: whatsappLinkInput.value,
                           instagram: instagramLinkInput.value,
                           facebook: facebookLinkInput.value,
                           telegram: telegramLinkInput.value,
                           x: xLinkInput.value,
                           email: companyEmailInput.value,
                        };

                        if (logoUrl) {
                            settingsData.logoUrl = logoUrl;
                        }

                        await setDoc(generalSettingsDocRef, settingsData, { merge: true });

                        generalSuccessMsg.classList.remove('hidden');
                        setTimeout(() => generalSuccessMsg.classList.add('hidden'), 3000);
                    } catch (error) {
                        console.error("Error saving general settings:", error);
                        alert('حدث خطأ أثناء حفظ الإعدادات العامة.');
                    } finally {
                        saveGeneralBtn.disabled = false;
                        saveGeneralBtn.textContent = 'حفظ التغييرات العامة';
                    }
                });
            }


        });
    </script>
</body>
</html>

